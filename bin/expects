#!/bin/bash

# A smaller test API like [Jest](https://jestjs.io/ja/docs/expect) for bash script.
#
# ```shell-session
# $ x=10
# $ expects "$x" to_be 10 && echo Success
# Success
# ```
# ```shell-session
# $ x=42
# $ expects "$x" to_be 10
# FAIL: expected {actual} to_be 10, but {actual} is: 42
# ```

actual_value=$1
compare_method=$2
expected_value=$3

function get_compare_method () {
  local compare_method=$1
  case $compare_method in
    to_equal)
      printf '%s\n' '=='
      ;;
    not_to_equal)
      printf '%s\n' '!='
      ;;
    to_be)
      printf '%s\n' '-eq'
      ;;
    not_to_be)
      printf '%s\n' '-ne'
      ;;
    to_be_less_than)
      printf '%s\n' '-lt'
      ;;
    to_be_less_than_or_equal)
      printf '%s\n' '-le'
      ;;
    to_be_greater_than)
      printf '%s\n' '-gt'
      ;;
    to_be_greater_than_or_equal)
      printf '%s\n' '-ge'
      ;;
  esac
}

compare_operator=$(get_compare_method "$compare_method")
if [[ $compare_operator == '' ]] ; then
  echo "Unknown compare method: $compare_method" >&2
  exit 1
fi

if eval "[[ \"$actual_value\" $compare_operator \"$expected_value\" ]]" ; then
  exit 0
fi

[[ $actual_value == '' ]] \
  && visible_actual_value='(empty or not defined)' \
  || visible_actual_value=$actual_value
echo "FAIL: expected {actual} $compare_method $expected_value, but {actual} is: $visible_actual_value" >&2
exit 1
